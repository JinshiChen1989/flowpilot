---
name: Environmental Sensors Threading Migration
status: open
created: 2025-08-29T18:59:14Z
updated: 2025-08-29T19:17:38Z
last_sync: 2025-08-29T19:17:38Z
github: https://github.com/JinshiChen1989/nagasware/issues/7
depends_on: [003]
parallel: false
conflicts_with: []
---

# Task: Environmental Sensors Threading Migration

## Description
Migrate compass (AK09918), light (VEML7700), and humidity (SHT40) sensors to use I2C threading pattern. Based on proven examples from Adafruit CircuitPython and Seeed libraries in submodules.

## Acceptance Criteria
- [ ] Migrate AK09918 compass to I2C threading pattern (Seeed example basis)
- [ ] Migrate VEML7700 light sensor (Adafruit example basis) 
- [ ] Migrate SHT40 humidity sensor to threading pattern
- [ ] Publish to autoware-aligned topics with standard sensor_msgs
- [ ] Validate all sensors work independently with threading locks

## Technical Details
Following proven patterns from submodules:

**AK09918 Compass** (Seeed_ICM20600_AK09918 example):
- `/sensing/compass/magnetic_field` → sensor_msgs/MagneticField
- 5Hz publishing rate

**VEML7700 Light** (Adafruit_CircuitPython_VEML7700 example):
- `/sensing/light/illuminance` → sensor_msgs/Illuminance  
- 2Hz publishing rate with auto-ranging

**SHT40 Humidity** (SHT40-AD1B example):
- `/sensing/humidity/data` → sensor_msgs/RelativeHumidity
- `/sensing/humidity/temperature` → sensor_msgs/Temperature
- 1Hz publishing rate

## Dependencies
- [ ] Task 003: IMU sensor threading migration completed
- [ ] Environmental sensors connected to I2C1 bus

## Effort Estimate
- Size: L
- Hours: 24
- Parallel: false (sequential sensor validation)

## Definition of Done
- [ ] All environmental sensors using I2C threading pattern
- [ ] Independent operation validated (no sensor interference)
- [ ] Autoware-aligned topic publishing with standard messages
- [ ] Hardware tested with real sensors on RK3588 I2C1 bus
- [ ] Timing requirements met for each sensor type